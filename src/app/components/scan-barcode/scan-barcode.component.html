<div class="scan-container">
  <header class="header">
    <button class="back-btn" (click)="goBack()">‚Üê Kembali</button>
    <h1>Scan Barcode Kendaraan</h1>
  </header>

  <main class="scan-content">
    <div class="scan-card">
      <div class="scanner-section">
        <div class="scanner-frame" [class.scanning]="isScanning">
          <!-- Camera Video Element -->
          <video 
            #videoElement 
            *ngIf="isScanning && hasCamera" 
            autoplay 
            playsinline
            class="scanner-video">
          </video>
          
          <!-- Scanner Overlay -->
          <div class="scanner-line" *ngIf="isScanning"></div>
          <div class="scanner-corners">
            <div class="corner top-left"></div>
            <div class="corner top-right"></div>
            <div class="corner bottom-left"></div>
            <div class="corner bottom-right"></div>
          </div>
          
          <!-- Scanner Content (when not scanning) -->
          <div class="scanner-content" *ngIf="!isScanning">
            <span class="scanner-icon">üì±</span>
            <p *ngIf="!hasCamera" class="camera-error">{{ cameraError }}</p>
          </div>
          
          <!-- Scanning Status -->
          <div class="scanner-status" *ngIf="isScanning">
            <span class="scanning-text">üîç Mencari barcode...</span>
            <p class="scan-instruction">Arahkan kamera ke barcode</p>
          </div>
        </div>
        
        <div class="scanner-controls">
          <button 
            class="scan-btn" 
            (click)="startScan()"
            [disabled]="isScanning || !hasCamera"
            *ngIf="!isScanning"
          >
            {{ hasCamera ? 'Mulai Scan Kamera' : 'Kamera Tidak Tersedia' }}
          </button>
          
          <button 
            class="stop-btn" 
            (click)="stopScanning()"
            *ngIf="isScanning"
          >
            Berhenti Scan
          </button>
          
          <!-- Manual Input Toggle Button -->
          <button 
            class="manual-toggle-btn" 
            (click)="toggleManualInput()"
            [disabled]="isScanning"
          >
            {{ showManualInput ? 'Sembunyikan Input Manual' : 'Masukkan Barcode Manual' }}
          </button>
        </div>
        
        <!-- Camera Error Message -->
        <div class="error-message" *ngIf="cameraError">
          <span class="error-icon">‚ö†Ô∏è</span>
          <p>{{ cameraError }}</p>
          <small>Silakan gunakan input manual di bawah</small>
        </div>
      </div>

      <div class="divider" *ngIf="showManualInput">
        <span>ATAU</span>
      </div>

      <div class="manual-input-section" *ngIf="showManualInput">
        <h3>Masukkan Barcode Manual</h3>
        <form (ngSubmit)="onSubmit()">
          <div class="input-group">
            <input
              type="text"
              [(ngModel)]="barcodeInput"
              name="barcode"
              placeholder="Masukkan barcode kendaraan"
              class="barcode-input"
              [disabled]="isLoadingTripData"
              (input)="onBarcodeInputChange()"
            />
            <div class="input-validation" *ngIf="barcodeInput.trim()">
              <span 
                class="validation-icon" 
                [class.valid]="isValidBarcodeInput()"
                [class.invalid]="!isValidBarcodeInput()"
              >
                {{ isValidBarcodeInput() ? '‚úÖ' : '‚ùå' }}
              </span>
              <span class="validation-text">
                {{ isValidBarcodeInput() ? 'Format valid' : 'Format barcode tidak valid' }}
              </span>
            </div>
          </div>
          
          <!-- Loading State -->
          <div class="loading-section" *ngIf="isLoadingTripData">
            <div class="loading-spinner"></div>
            <p class="loading-text">Mengambil data perjalanan...</p>
          </div>
          
          <!-- Error Message -->
          <div class="error-message" *ngIf="tripDataError && !isLoadingTripData">
            <span class="error-icon">‚ö†Ô∏è</span>
            <p>{{ tripDataError }}</p>
          </div>
          
          <button 
            type="submit" 
            class="submit-btn"
            [disabled]="isLoadingTripData || !barcodeInput.trim()"
          >
            {{ isLoadingTripData ? 'Memuat...' : 'Ambil Data Perjalanan' }}
          </button>
        </form>
      </div>
    </div>
  </main>
</div>
