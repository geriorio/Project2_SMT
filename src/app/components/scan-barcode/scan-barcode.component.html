<div class="scan-container">
  <header class="header">
    <button class="back-btn" (click)="goBack()">â† Back</button>
    <h1>Scan Vehicle Barcode</h1>
  </header>

  <main class="scan-content">
    <div class="scan-card">
      <div class="scanner-section">
        <div class="scanner-frame" [class.scanning]="isScanning">
          <!-- Camera Video Element -->
          <video 
            #videoElement 
            *ngIf="isScanning && hasCamera" 
            autoplay 
            playsinline
            class="scanner-video">
          </video>
          
          <!-- Scanner Overlay -->
          <div class="scanner-line" *ngIf="isScanning"></div>
          <div class="scanner-corners">
            <div class="corner top-left"></div>
            <div class="corner top-right"></div>
            <div class="corner bottom-left"></div>
            <div class="corner bottom-right"></div>
          </div>
          
          <!-- Scanner Content (when not scanning) -->
          <div class="scanner-content" *ngIf="!isScanning">
            <span class="scanner-icon">ğŸ“±</span>
            <p *ngIf="!hasCamera" class="camera-error">{{ cameraError }}</p>
          </div>
          
          <!-- Scanning Status -->
          <div class="scanner-status" *ngIf="isScanning">
            <span class="scanning-text">ğŸ” Scanning for barcode...</span>
            <p class="scan-instruction">Point camera at barcode</p>
          </div>
        </div>
        
        <div class="scanner-controls">
          <button 
            class="scan-btn" 
            (click)="startScan()"
            [disabled]="isScanning || !hasCamera"
            *ngIf="!isScanning"
          >
            {{ hasCamera ? 'Start Camera Scan' : 'Camera Unavailable' }}
          </button>
          
          <button 
            class="stop-btn" 
            (click)="stopScanning()"
            *ngIf="isScanning"
          >
            Stop Scanning
          </button>
        </div>
        
        <!-- Camera Error Message -->
        <div class="error-message" *ngIf="cameraError">
          <span class="error-icon">âš ï¸</span>
          <p>{{ cameraError }}</p>
          <small>Please use manual input below</small>
        </div>

        <!-- Scanning Tips for Long Barcodes -->
        <div class="scan-tips" *ngIf="hasCamera">
          <h4>ğŸ“‹ Scanning Tips for Long Barcodes</h4>
          <ul>
            <li>ğŸ”¦ Ensure bright, even lighting</li>
            <li>ğŸ“ Keep barcode 20-40cm from camera for long codes</li>
            <li>ğŸ“ Hold phone steady and parallel to barcode</li>
            <li>ğŸ¯ Center the entire barcode in the scanning area</li>
            <li>ğŸ” Wait for auto-focus to stabilize</li>
            <li>ğŸ“± Use landscape orientation for very long barcodes</li>
            <li>ğŸ”„ Try multiple angles if detection fails</li>
          </ul>
        </div>
      </div>

      <div class="divider">
        <span>OR</span>
      </div>

      <div class="manual-input-section">
        <h3>Enter Barcode Manually</h3>
        <form (ngSubmit)="onSubmit()">
          <div class="input-group">
            <input
              type="text"
              [(ngModel)]="barcodeInput"
              name="barcode"
              placeholder="Enter vehicle barcode"
              class="barcode-input"
              [disabled]="isLoadingTripData"
              (input)="onBarcodeInputChange()"
            />
            <div class="input-validation" *ngIf="barcodeInput.trim()">
              <span 
                class="validation-icon" 
                [class.valid]="isValidBarcodeInput()"
                [class.invalid]="!isValidBarcodeInput()"
              >
                {{ isValidBarcodeInput() ? 'âœ…' : 'âŒ' }}
              </span>
              <span class="validation-text">
                {{ isValidBarcodeInput() ? 'Valid format' : 'Invalid barcode format' }}
              </span>
            </div>
          </div>
          
          <!-- Loading State -->
          <div class="loading-section" *ngIf="isLoadingTripData">
            <div class="loading-spinner"></div>
            <p class="loading-text">Getting trip data...</p>
          </div>
          
          <!-- Error Message -->
          <div class="error-message" *ngIf="tripDataError && !isLoadingTripData">
            <span class="error-icon">âš ï¸</span>
            <p>{{ tripDataError }}</p>
          </div>
          
          <button 
            type="submit" 
            class="submit-btn"
            [disabled]="isLoadingTripData || !barcodeInput.trim()"
          >
            {{ isLoadingTripData ? 'Loading...' : 'Get Trip Data' }}
          </button>
        </form>
      </div>
    </div>
  </main>
</div>
