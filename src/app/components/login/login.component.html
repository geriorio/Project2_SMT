<div class="login-container">
  <div class="login-card">
    <div class="logo-section">
      <h1>🚚 Truck Management</h1>
      <p>Please login to continue</p>
    </div>
    
    <form (ngSubmit)="onLogin()" class="login-form" *ngIf="!isLoading">
      <div class="form-group">
        <label for="site">Site Code</label>
        <input
          type="text"
          id="site"
          [(ngModel)]="site"
          name="site"
          placeholder="Enter site code (e.g., SGI030)"
          (input)="onSiteChange()"
          required
          [class.error]="errorMessage"
        />
      </div>

      <div class="form-group">
        <label for="empCode">Employee Code</label>
        <input
          type="text"
          id="empCode"
          [(ngModel)]="empCode"
          name="empCode"
          placeholder="Enter your employee code"
          (input)="onEmpCodeChange()"
          required
          [class.error]="errorMessage"
        />
      </div>
      
      <button type="submit" class="login-btn" [disabled]="!empCode.trim() || !site.trim() || !manualLatitude || !manualLongitude">
        🚀 Login with Custom Location
      </button>
      
      <button type="button" class="location-check-btn" (click)="getLocationOnly()">
        📍 Preview Current Location
      </button>

      <!-- Location Input Form - Always Visible -->
      <div class="location-section">
        <h4>📍 Set Location Coordinates</h4>
        <p style="font-size: 12px; color: #666; margin: 0 0 16px 0; text-align: center;">
          ℹ️ Enter coordinates manually or use "Preview Current Location" to detect and copy your GPS coordinates
        </p>

        <!-- Coordinate Inputs -->
        <div class="coordinate-inputs">
          <div class="form-group">
            <label for="manualLatitude">Latitude *</label>
            <input
              type="number"
              id="manualLatitude"
              [(ngModel)]="manualLatitude"
              name="manualLatitude"
              placeholder="e.g., -6.2088"
              step="0.000001"
              (input)="onCoordinateChange()"
              [class.error]="errorMessage"
              required
            />
          </div>
          
          <div class="form-group">
            <label for="manualLongitude">Longitude *</label>
            <input
              type="number"
              id="manualLongitude"
              [(ngModel)]="manualLongitude"
              name="manualLongitude"
              placeholder="e.g., 106.8456"
              step="0.000001"
              (input)="onCoordinateChange()"
              [class.error]="errorMessage"
              required
            />
          </div>
        </div>

        <div class="coordinate-info" *ngIf="manualLatitude && manualLongitude">
          <p class="coord-display">
            📍 Current: {{ manualLatitude }}, {{ manualLongitude }}
          </p>
        </div>
      </div>
    </form>

    <!-- Loading State -->
    <div class="loading-section" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p class="loading-text">{{ locationStatus }}</p>
    </div>

    <!-- Error Message -->
    <div class="error-alert" *ngIf="errorMessage && !isLoading && !showLocationInfo && !showAutoLocation">
      <p>⚠️ {{ errorMessage }}</p>
    </div>

    <!-- Auto-Detected Location Information -->
    <div class="location-info" *ngIf="showAutoLocation && !isLoading">
      <div class="location-status success">
        <h3>📍 Auto-Detected Location</h3>
        <p>{{ locationStatus }}</p>
      </div>

      <div class="location-details" *ngIf="autoDetectedLocation">
        <h4>🌍 Your Current GPS Location</h4>
        <div class="coordinate-item">
          <label>Latitude:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(autoDetectedLocation.latitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(autoDetectedLocation.latitude))">
              📋
            </button>
          </div>
        </div>
        
        <div class="coordinate-item">
          <label>Longitude:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(autoDetectedLocation.longitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(autoDetectedLocation.longitude))">
              📋
            </button>
          </div>
        </div>

        <div class="coordinate-item">
          <label>Coordinates:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(autoDetectedLocation.latitude) }}, {{ formatCoordinate(autoDetectedLocation.longitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(autoDetectedLocation.latitude) + ', ' + formatCoordinate(autoDetectedLocation.longitude))">
              📋
            </button>
          </div>
        </div>

        <div class="coordinate-item" *ngIf="autoDetectedLocation.accuracy">
          <label>Accuracy:</label>
          <div class="coordinate-value">
            <span>{{ autoDetectedLocation.accuracy.toFixed(0) }}m</span>
          </div>
        </div>
      </div>

      <div class="location-actions">
        <button class="btn-retry" (click)="useDetectedLocation()">
          ✅ Use This Location
        </button>
        <button class="btn-close" (click)="hideAutoLocation()">
          ✖ Close
        </button>
      </div>
    </div>

    <!-- Location Information -->
    <div class="location-info" *ngIf="showLocationInfo && !isLoading && !showAutoLocation">
      <div class="location-status success">
        <h3>📍 Location Information</h3>
        <p>{{ locationStatus }}</p>
      </div>

      <div class="location-details" *ngIf="userLocation">
        <h4>📍 Your Current Location</h4>
        <div class="coordinate-item">
          <label>Latitude:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(userLocation.latitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(userLocation.latitude))">
              📋
            </button>
          </div>
        </div>
        
        <div class="coordinate-item">
          <label>Longitude:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(userLocation.longitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(userLocation.longitude))">
              📋
            </button>
          </div>
        </div>

        <div class="coordinate-item">
          <label>Coordinates:</label>
          <div class="coordinate-value">
            <span>{{ formatCoordinate(userLocation.latitude) }}, {{ formatCoordinate(userLocation.longitude) }}</span>
            <button class="copy-btn" (click)="copyToClipboard(formatCoordinate(userLocation.latitude) + ', ' + formatCoordinate(userLocation.longitude))">
              📋
            </button>
          </div>
        </div>

        <div class="coordinate-item" *ngIf="userLocation.accuracy">
          <label>Accuracy:</label>
          <div class="coordinate-value">
            <span>{{ userLocation.accuracy.toFixed(0) }}m</span>
          </div>
        </div>
      </div>

      <div class="location-actions">
        <button class="btn-close" (click)="hideLocationInfo()">
          ✖ Close
        </button>
      </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="locationStatus.includes('successfully') && isLoading">
      <h3>🎉 Location Detected!</h3>
      <p>Redirecting to dashboard...</p>
    </div>
  </div>
</div>
